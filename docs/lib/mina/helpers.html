<!DOCTYPE html>
<html>
<head>
  <title>Default helpers</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../style.css" />
  <script src='http://cdnjs.cloudflare.com/ajax/libs/jquery/1.8.0/jquery-1.8.0.min.js'></script>
</head>
<body>
  <div id="area">
    <div class='file-header'>
              <a href="https://github.com/nadarei/mina/blob/master/lib/mina/helpers.rb">
          <strong title='lib/mina/helpers.rb'>helpers.rb</strong>
          <small>View source</small>
        </a>
          </div>

    <table cellpadding="0" cellspacing="0" class="extension-rb">
      <thead>
        <tr>
          <th class="docs">
          </th>
          <th class="code">
          </th>
        </tr>
      </thead>
      <tbody>
                                      
          <tr id="Helpers-Default-helpers" class="heading">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#Helpers-Default-helpers">&#182;</a>
              </div>
              <h1>Helpers: Default helpers</h1>            </td>
            <td class="code">
              <div class="highlight"><pre><span class="k">module</span> <span class="nn">Mina</span>
  <span class="k">module</span> <span class="nn">Helpers</span></pre></div>            </td>
          </tr>
                                      
          <tr id="invoke" class="heading">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#invoke">&#182;</a>
              </div>
              <h3>invoke</h3>            </td>
            <td class="code">
                          </td>
          </tr>
                                      
          <tr id="section-2" class="">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Invokes another Rake task.</p>

<p>Invokes the task given in <code>task</code>. Returns nothing.</p>

<pre><code>invoke :'git:clone'
invoke :restart
</code></pre>            </td>
            <td class="code">
              <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">invoke</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>
      <span class="no">Rake</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">invoke_task</span> <span class="n">task</span>
    <span class="k">end</span></pre></div>            </td>
          </tr>
                                      
          <tr id="erb" class="heading">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#erb">&#182;</a>
              </div>
              <h3>erb</h3>            </td>
            <td class="code">
                          </td>
          </tr>
                                      
          <tr id="section-4" class="">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Evaluates an ERB block in the current scope and returns a string.</p>

<pre><code>a = 1
b = 2

# Assuming foo.erb is &lt;%= a %&gt; and &lt;%= b %&gt;
puts erb('foo.erb')

#=&gt; "1 and 2"
</code></pre>

<p>Returns the output string of the ERB template.</p>            </td>
            <td class="code">
              <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">erb</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="nb">binding</span><span class="p">)</span>
      <span class="nb">require</span> <span class="s1">&#39;erb&#39;</span>
      <span class="n">erb</span> <span class="o">=</span> <span class="no">ERB</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="no">File</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">file</span><span class="p">))</span>
      <span class="n">erb</span><span class="o">.</span><span class="n">result</span> <span class="n">b</span>
    <span class="k">end</span></pre></div>            </td>
          </tr>
                                      
          <tr id="run" class="heading">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#run">&#182;</a>
              </div>
              <h3>run!</h3>            </td>
            <td class="code">
                          </td>
          </tr>
                                      
          <tr id="section-6" class="">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>SSHs into the host and runs the code that has been queued.</p>

<p>This is already automatically invoked before Rake exits to run all
commands that have been queued up.</p>

<pre><code>queue "sudo restart"
run!
</code></pre>

<p>Returns nothing.</p>            </td>
            <td class="code">
              <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">run!</span>
      <span class="n">report_time</span> <span class="p">{</span> <span class="n">ssh</span> <span class="n">commands</span><span class="p">(</span><span class="ss">:default</span><span class="p">)</span> <span class="p">}</span>
    <span class="k">end</span></pre></div>            </td>
          </tr>
                                      
          <tr id="report-time" class="heading">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#report-time">&#182;</a>
              </div>
              <h3>report_time</h3>            </td>
            <td class="code">
                          </td>
          </tr>
                                      
          <tr id="section-8" class="">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Report time elapsed in the block.
Returns the output of the block.</p>

<pre><code>report_time do
  sleep 2
  # do other things
end

# Output:
# Elapsed time: 2.0 seconds
</code></pre>            </td>
            <td class="code">
              <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">report_time</span><span class="p">(</span><span class="o">&amp;</span><span class="n">blk</span><span class="p">)</span>
      <span class="n">time</span><span class="p">,</span> <span class="n">output</span> <span class="o">=</span> <span class="n">measure</span> <span class="o">&amp;</span><span class="n">blk</span>
      <span class="n">print_str</span> <span class="s2">&quot;Elapsed time: %.2f seconds&quot;</span> <span class="o">%</span> <span class="o">[</span><span class="n">time</span><span class="o">]</span>
      <span class="n">output</span>
    <span class="k">end</span></pre></div>            </td>
          </tr>
                                      
          <tr id="measure" class="heading">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#measure">&#182;</a>
              </div>
              <h3>measure</h3>            </td>
            <td class="code">
                          </td>
          </tr>
                                      
          <tr id="section-10" class="">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Measures the time (in ms) a block takes.
Returns a [time, output] tuple.</p>            </td>
            <td class="code">
              <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">measure</span><span class="p">(</span><span class="o">&amp;</span><span class="n">blk</span><span class="p">)</span>
      <span class="n">t</span> <span class="o">=</span> <span class="no">Time</span><span class="o">.</span><span class="n">now</span>
      <span class="n">output</span> <span class="o">=</span> <span class="k">yield</span>
      <span class="o">[</span><span class="p">(</span><span class="no">Time</span><span class="o">.</span><span class="n">now</span> <span class="o">-</span> <span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">to_i</span><span class="p">,</span> <span class="n">output</span><span class="o">]</span>
    <span class="k">end</span></pre></div>            </td>
          </tr>
                                      
          <tr id="mina-cleanup" class="heading">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#mina-cleanup">&#182;</a>
              </div>
              <h3>mina_cleanup</h3>            </td>
            <td class="code">
                          </td>
          </tr>
                                      
          <tr id="section-12" class="">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p><strong>Internal:</strong> Invoked when Rake exits.</p>

<p>Returns nothing.</p>            </td>
            <td class="code">
              <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">mina_cleanup!</span>
      <span class="n">run!</span> <span class="k">if</span> <span class="n">commands</span><span class="o">.</span><span class="n">any?</span>
    <span class="k">end</span></pre></div>            </td>
          </tr>
                                      
          <tr id="Errors" class="heading">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#Errors">&#182;</a>
              </div>
              <h2>Errors</h2>            </td>
            <td class="code">
                          </td>
          </tr>
                                      
          <tr id="die" class="heading">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#die">&#182;</a>
              </div>
              <h3>die</h3>            </td>
            <td class="code">
                          </td>
          </tr>
                                      
          <tr id="section-15" class="">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>Exits with a nice looking message.
Returns nothing.</p>

<pre><code>die 2
die 2, "Tests failed"
</code></pre>            </td>
            <td class="code">
              <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">die</span><span class="p">(</span><span class="n">code</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="n">null</span><span class="p">)</span>
      <span class="n">str</span> <span class="o">=</span> <span class="s2">&quot;Failed with status </span><span class="si">#{</span><span class="n">code</span><span class="si">}</span><span class="s2">&quot;</span>
      <span class="n">str</span> <span class="o">+=</span> <span class="s2">&quot; (</span><span class="si">#{</span><span class="n">msg</span><span class="si">}</span><span class="s2">)&quot;</span> <span class="k">if</span> <span class="n">msg</span>
      <span class="n">err</span> <span class="o">=</span> <span class="no">Failed</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">str</span><span class="p">)</span>
      <span class="n">err</span><span class="o">.</span><span class="n">exitstatus</span> <span class="o">=</span> <span class="n">code</span>
      <span class="k">raise</span> <span class="n">err</span>
    <span class="k">end</span></pre></div>            </td>
          </tr>
                                      
          <tr id="error" class="heading">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#error">&#182;</a>
              </div>
              <h3>error</h3>            </td>
            <td class="code">
                          </td>
          </tr>
                                      
          <tr id="section-17" class="">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p><strong>Internal:</strong> Prints to stdout.
Consider using <code>print_error</code> instead.</p>            </td>
            <td class="code">
              <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">error</span><span class="p">(</span><span class="n">str</span><span class="p">)</span>
      <span class="vg">$stderr</span><span class="o">.</span><span class="n">write</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">str</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="k">end</span></pre></div>            </td>
          </tr>
                                      
          <tr id="Queueing" class="heading">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#Queueing">&#182;</a>
              </div>
              <h2>Queueing</h2>            </td>
            <td class="code">
                          </td>
          </tr>
                                      
          <tr id="queue" class="heading">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#queue">&#182;</a>
              </div>
              <h3>queue</h3>            </td>
            <td class="code">
                          </td>
          </tr>
                                      
          <tr id="section-20" class="">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>Queues code to be ran.</p>

<p>This queues code to be ran to the current code bucket (defaults to <code>:default</code>).
To get the things that have been queued, use commands[:default]</p>

<p>Returns nothing.</p>

<pre><code>queue "sudo restart"
queue "true"

commands == ['sudo restart', 'true']
</code></pre>            </td>
            <td class="code">
              <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">queue</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
      <span class="n">commands</span>
      <span class="n">commands</span><span class="p">(</span><span class="vi">@to</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">unindent</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
    <span class="k">end</span></pre></div>            </td>
          </tr>
                                      
          <tr id="queue" class="heading">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#queue">&#182;</a>
              </div>
              <h3>queue!</h3>            </td>
            <td class="code">
                          </td>
          </tr>
                                      
          <tr id="section-22" class="">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>Shortcut for <code>queue</code>ing a command that shows up in verbose mode.</p>            </td>
            <td class="code">
              <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">queue!</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
      <span class="n">queue</span> <span class="n">echo_cmd</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
    <span class="k">end</span></pre></div>            </td>
          </tr>
                                      
          <tr id="echo-cmd" class="heading">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#echo-cmd">&#182;</a>
              </div>
              <h3>echo_cmd</h3>            </td>
            <td class="code">
                          </td>
          </tr>
                                      
          <tr id="section-24" class="">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>Converts a bash command to a command that echoes before execution.
Used to show commands in verbose mode. This does nothing unless verbose mode is on.</p>

<p>Returns a string of the compound bash command, typically in the format of
<code>echo xx &amp;&amp; xx</code>. However, if <code>verbose_mode?</code> is false, it returns the
input string unharmed.</p>

<pre><code>echo_cmd("ln -nfs releases/2 current")
#=&gt; echo "$ ln -nfs releases/2 current" &amp;&amp; ln -nfs releases/2 current
</code></pre>            </td>
            <td class="code">
              <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">echo_cmd</span><span class="p">(</span><span class="n">str</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">verbose_mode?</span>
        <span class="s2">&quot;echo </span><span class="si">#{</span><span class="no">Shellwords</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="s2">&quot;$ &quot;</span> <span class="o">+</span> <span class="n">str</span><span class="p">)</span><span class="si">}</span><span class="s2"> &amp;&amp;</span><span class="se">\n</span><span class="si">#{</span><span class="n">str</span><span class="si">}</span><span class="s2">&quot;</span>
      <span class="k">else</span>
        <span class="n">str</span>
      <span class="k">end</span>
    <span class="k">end</span></pre></div>            </td>
          </tr>
                                      
          <tr id="Commands" class="heading">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#Commands">&#182;</a>
              </div>
              <h2>Commands</h2>            </td>
            <td class="code">
                          </td>
          </tr>
                                      
          <tr id="commands" class="heading">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#commands">&#182;</a>
              </div>
              <h3>commands</h3>            </td>
            <td class="code">
                          </td>
          </tr>
                                      
          <tr id="section-27" class="">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>Returns an array of queued code strings.</p>

<p>You may give an optional <code>aspect</code>.</p>

<p>Returns an array of strings.</p>

<pre><code>queue "sudo restart"
queue "true"

to :clean do
  queue "rm"
end

commands == ["sudo restart", "true"]
commands(:clean) == ["rm"]
</code></pre>            </td>
            <td class="code">
              <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">commands</span><span class="p">(</span><span class="n">aspect</span><span class="o">=</span><span class="ss">:default</span><span class="p">)</span>
      <span class="p">(</span><span class="vi">@commands</span> <span class="o">||=</span> <span class="k">begin</span>
        <span class="vi">@to</span> <span class="o">=</span> <span class="ss">:default</span>
        <span class="no">Hash</span><span class="o">.</span><span class="n">new</span> <span class="p">{</span> <span class="o">|</span><span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="o">|</span> <span class="n">h</span><span class="o">[</span><span class="n">k</span><span class="o">]</span> <span class="o">=</span> <span class="nb">Array</span><span class="o">.</span><span class="n">new</span> <span class="p">}</span>
      <span class="k">end</span><span class="p">)</span><span class="o">[</span><span class="n">aspect</span><span class="o">]</span>
    <span class="k">end</span></pre></div>            </td>
          </tr>
                                      
          <tr id="isolate" class="heading">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#isolate">&#182;</a>
              </div>
              <h3>isolate</h3>            </td>
            <td class="code">
                          </td>
          </tr>
                                      
          <tr id="section-29" class="">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>Starts a new block where new <code>commands</code> are collected.</p>

<p>Returns nothing.</p>

<pre><code>queue "sudo restart"
queue "true"
commands.should == ['sudo restart', 'true']

isolate do
  queue "reload"
  commands.should == ['reload']
end

commands.should == ['sudo restart', 'true']
</code></pre>            </td>
            <td class="code">
              <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">isolate</span><span class="p">(</span><span class="o">&amp;</span><span class="n">blk</span><span class="p">)</span>
      <span class="n">old</span><span class="p">,</span> <span class="vi">@commands</span> <span class="o">=</span> <span class="vi">@commands</span><span class="p">,</span> <span class="kp">nil</span>
      <span class="n">result</span> <span class="o">=</span> <span class="k">yield</span>
      <span class="n">new_code</span><span class="p">,</span> <span class="vi">@commands</span> <span class="o">=</span> <span class="vi">@commands</span><span class="p">,</span> <span class="n">old</span>
      <span class="n">result</span>
    <span class="k">end</span></pre></div>            </td>
          </tr>
                                      
          <tr id="in-directory" class="heading">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#in-directory">&#182;</a>
              </div>
              <h3>in_directory</h3>            </td>
            <td class="code">
                          </td>
          </tr>
                                      
          <tr id="section-31" class="">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>Starts a new block where #commands are collected, to be executed inside <code>path</code>.</p>

<p>Returns nothing.</p>

<p>in_directory './webapp' do
    queue "./reload"
  end</p>

<p>commands.should == ['cd ./webapp &amp;&amp; (./reload &amp;&amp; true)']</p>            </td>
            <td class="code">
              <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">in_directory</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">blk</span><span class="p">)</span>
      <span class="n">isolated_commands</span> <span class="o">=</span> <span class="n">isolate</span> <span class="p">{</span> <span class="k">yield</span><span class="p">;</span> <span class="n">commands</span> <span class="p">}</span>
      <span class="n">isolated_commands</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">cmd</span><span class="o">|</span> <span class="n">queue</span> <span class="s2">&quot;(cd </span><span class="si">#{</span><span class="n">path</span><span class="si">}</span><span class="s2"> &amp;&amp; (</span><span class="si">#{</span><span class="n">cmd</span><span class="si">}</span><span class="s2">))&quot;</span> <span class="p">}</span>
    <span class="k">end</span></pre></div>            </td>
          </tr>
                                      
          <tr id="section-32" class="">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>Defines instructions on how to do a certain thing.
This makes the commands that are <code>queue</code>d go into a different bucket in commands.</p>

<p>Returns nothing.</p>

<pre><code>to :prepare do
  run "bundle install"
end
to :launch do
  run "nginx -s restart"
end

commands(:prepare) == ["bundle install"]
commands(:restart) == ["nginx -s restart"]
</code></pre>            </td>
            <td class="code">
              <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">to</span><span class="p">(</span><span class="nb">name</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">blk</span><span class="p">)</span>
      <span class="n">old</span><span class="p">,</span> <span class="vi">@to</span> <span class="o">=</span> <span class="vi">@to</span><span class="p">,</span> <span class="nb">name</span>
      <span class="k">yield</span>
    <span class="k">ensure</span>
      <span class="vi">@to</span> <span class="o">=</span> <span class="n">old</span>
    <span class="k">end</span></pre></div>            </td>
          </tr>
                                      
          <tr id="Settings-helpers" class="heading">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#Settings-helpers">&#182;</a>
              </div>
              <h2>Settings helpers</h2>            </td>
            <td class="code">
                          </td>
          </tr>
                                      
          <tr id="set" class="heading">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#set">&#182;</a>
              </div>
              <h3>set</h3>            </td>
            <td class="code">
                          </td>
          </tr>
                                      
          <tr id="section-35" class="">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>Sets settings.
Sets given symbol <code>key</code> to value in <code>value</code>.</p>

<p>Returns the value.</p>

<pre><code>set :domain, 'kickflip.me'
</code></pre>            </td>
            <td class="code">
              <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">set</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
      <span class="n">settings</span><span class="o">.</span><span class="n">send</span> <span class="ss">:&quot;</span><span class="si">#{</span><span class="n">key</span><span class="si">}</span><span class="ss">=&quot;</span><span class="p">,</span> <span class="n">value</span>
    <span class="k">end</span></pre></div>            </td>
          </tr>
                                      
          <tr id="set-default" class="heading">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#set-default">&#182;</a>
              </div>
              <h3>set_default</h3>            </td>
            <td class="code">
                          </td>
          </tr>
                                      
          <tr id="section-37" class="">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>Sets default settings.
Sets given symbol <code>key</code> to value in <code>value</code> only if the key isn't set yet.</p>

<p>Returns the value.</p>

<pre><code>set_default :term_mode, :pretty
set :term_mode, :system
settings.term_mode.should == :system

set :term_mode, :system
set_default :term_mode, :pretty
settings.term_mode.should == :system
</code></pre>            </td>
            <td class="code">
              <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">set_default</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
      <span class="n">settings</span><span class="o">.</span><span class="n">send</span> <span class="ss">:&quot;</span><span class="si">#{</span><span class="n">key</span><span class="si">}</span><span class="ss">=&quot;</span><span class="p">,</span> <span class="n">value</span>  <span class="k">unless</span> <span class="n">settings</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="ss">:&quot;</span><span class="si">#{</span><span class="n">key</span><span class="si">}</span><span class="ss">?&quot;</span><span class="p">)</span>
    <span class="k">end</span></pre></div>            </td>
          </tr>
                                      
          <tr id="settings" class="heading">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#settings">&#182;</a>
              </div>
              <h3>settings</h3>            </td>
            <td class="code">
                          </td>
          </tr>
                                      
          <tr id="section-39" class="">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>Accesses the settings hash.</p>

<pre><code>set :domain, 'kickflip.me'

settings.domain  #=&gt; 'kickflip.me'
domain           #=&gt; 'kickflip.me'
</code></pre>            </td>
            <td class="code">
              <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">settings</span>
      <span class="vi">@settings</span> <span class="o">||=</span> <span class="no">Settings</span><span class="o">.</span><span class="n">new</span>
    <span class="k">end</span></pre></div>            </td>
          </tr>
                                      
          <tr id="method-missing" class="heading">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#method-missing">&#182;</a>
              </div>
              <h3>method_missing</h3>            </td>
            <td class="code">
                          </td>
          </tr>
                                      
          <tr id="section-41" class="">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>Hook to get settings.
See #settings for an explanation.</p>

<p>Returns things.</p>            </td>
            <td class="code">
              <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">method_missing</span><span class="p">(</span><span class="n">meth</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">blk</span><span class="p">)</span>
      <span class="n">settings</span><span class="o">.</span><span class="n">send</span> <span class="n">meth</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span>
    <span class="k">end</span></pre></div>            </td>
          </tr>
                                      
          <tr id="Command-line-mode-helpers" class="heading">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#Command-line-mode-helpers">&#182;</a>
              </div>
              <h2>Command line mode helpers</h2>            </td>
            <td class="code">
                          </td>
          </tr>
                                      
          <tr id="verbose-mode" class="heading">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#verbose-mode">&#182;</a>
              </div>
              <h3>verbose_mode?</h3>            </td>
            <td class="code">
                          </td>
          </tr>
                                      
          <tr id="section-44" class="">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>Checks if Rake was invoked with --verbose.</p>

<p>Returns true or false.</p>            </td>
            <td class="code">
              <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">verbose_mode?</span>
      <span class="k">if</span> <span class="no">Rake</span><span class="o">.</span><span class="n">respond_to?</span><span class="p">(</span><span class="ss">:verbose</span><span class="p">)</span></pre></div>            </td>
          </tr>
                                      
          <tr id="section-45" class="">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p>Rake 0.9.x</p>            </td>
            <td class="code">
              <div class="highlight"><pre>        <span class="no">Rake</span><span class="o">.</span><span class="n">verbose</span> <span class="o">==</span> <span class="kp">true</span>
      <span class="k">else</span></pre></div>            </td>
          </tr>
                                      
          <tr id="section-46" class="">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>Rake 0.8.x</p>            </td>
            <td class="code">
              <div class="highlight"><pre>        <span class="no">RakeFileUtils</span><span class="o">.</span><span class="n">verbose_flag</span> <span class="o">!=</span> <span class="ss">:default</span>
      <span class="k">end</span>
    <span class="k">end</span></pre></div>            </td>
          </tr>
                                      
          <tr id="simulate-mode" class="heading">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#simulate-mode">&#182;</a>
              </div>
              <h3>simulate_mode?</h3>            </td>
            <td class="code">
                          </td>
          </tr>
                                      
          <tr id="section-48" class="">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>Checks if Rake was invoked with --simulate.</p>

<p>Returns true or false.</p>            </td>
            <td class="code">
              <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">simulate_mode?</span>
      <span class="o">!!</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;simulate&#39;</span><span class="o">]</span>
    <span class="k">end</span></pre></div>            </td>
          </tr>
                                      
          <tr id="Internal-helpers" class="heading">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#Internal-helpers">&#182;</a>
              </div>
              <h2>Internal helpers</h2>            </td>
            <td class="code">
                          </td>
          </tr>
                                      
          <tr id="indent" class="heading">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#indent">&#182;</a>
              </div>
              <h3>indent</h3>            </td>
            <td class="code">
                          </td>
          </tr>
                                      
          <tr id="section-51" class="">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p>Indents a given code block with <code>count</code> spaces before it.</p>            </td>
            <td class="code">
              <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">indent</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">str</span><span class="p">)</span>
      <span class="n">str</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="sr">/^/</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="o">*</span><span class="n">count</span><span class="p">)</span>
    <span class="k">end</span></pre></div>            </td>
          </tr>
                                      
          <tr id="unindent" class="heading">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#unindent">&#182;</a>
              </div>
              <h3>unindent</h3>            </td>
            <td class="code">
                          </td>
          </tr>
                                      
          <tr id="section-53" class="">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <p><strong>Internal:</strong> Normalizes indentation on a given string.</p>

<p>Returns the normalized string without extraneous indentation.</p>

<pre><code>puts unindent %{
  Hello
    There
}
# Output:
# Hello
#   There
</code></pre>            </td>
            <td class="code">
              <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">unindent</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">code</span> <span class="o">=~</span> <span class="sr">/^\n([ \t]+)/</span>
        <span class="n">code</span> <span class="o">=</span> <span class="n">code</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="sr">/^</span><span class="si">#{</span><span class="vg">$1</span><span class="si">}</span><span class="sr">/</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
      <span class="k">end</span>

      <span class="n">code</span><span class="o">.</span><span class="n">strip</span>
    <span class="k">end</span></pre></div>            </td>
          </tr>
                                      
          <tr id="reindent" class="heading">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#reindent">&#182;</a>
              </div>
              <h3>reindent</h3>            </td>
            <td class="code">
                          </td>
          </tr>
                                      
          <tr id="section-55" class="">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <p>Resets the indentation on a given code block.</p>            </td>
            <td class="code">
              <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">reindent</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">code</span><span class="p">)</span>
      <span class="n">indent</span> <span class="n">n</span><span class="p">,</span> <span class="n">unindent</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
    <span class="k">end</span>

  <span class="k">end</span>
<span class="k">end</span>

</pre></div>            </td>
          </tr>
              </tbody>
    </table>

    
  </div>

  <div id="sidebar">
    <div class='header search'>
      <input type='text' name='search' id='search-box' placeholder='Search...' />
    </div>

    <div class='header tabs'>
      <button class='active' data-tab='pages'>Pages</button>
      <button data-tab='files'>Files</button>
    </div>

    <div class='scroll-area'>
      <!-- .multipage here means there will be a sidebar of many pages. -->
      <div class='list pages multipage'>
                  
          <!-- Breadcrumbs -->
                                  <ul class='breadcrumbs'>
                              
                <li class='page back'>
                                  <a href='../../index.html'>Welcome to Mina</a>
                                              
                <li class='page back'>
                                  <span class='a'>Helpers</span>
                                          </ul>
          
          <!-- The page and its headings -->
          <ul class='current-page'>
                        
            <li class='page level-0'>
              <a href='#'>Default helpers</a>
                              <ul>
                                                                              <li class='heading level-3'>
                      <a href="#invoke">
                        invoke                      </a>
                    </li>
                                                                              <li class='heading level-3'>
                      <a href="#erb">
                        erb                      </a>
                    </li>
                                                                              <li class='heading level-3'>
                      <a href="#run">
                        run!                      </a>
                    </li>
                                                                              <li class='heading level-3'>
                      <a href="#report-time">
                        report_time                      </a>
                    </li>
                                                                              <li class='heading level-3'>
                      <a href="#measure">
                        measure                      </a>
                    </li>
                                                                              <li class='heading level-3'>
                      <a href="#mina-cleanup">
                        mina_cleanup                      </a>
                    </li>
                                                                              <li class='heading level-2'>
                      <a href="#Errors">
                        Errors                      </a>
                    </li>
                                                                              <li class='heading level-3'>
                      <a href="#die">
                        die                      </a>
                    </li>
                                                                              <li class='heading level-3'>
                      <a href="#error">
                        error                      </a>
                    </li>
                                                                              <li class='heading level-2'>
                      <a href="#Queueing">
                        Queueing                      </a>
                    </li>
                                                                              <li class='heading level-3'>
                      <a href="#queue">
                        queue                      </a>
                    </li>
                                                                              <li class='heading level-3'>
                      <a href="#queue">
                        queue!                      </a>
                    </li>
                                                                              <li class='heading level-3'>
                      <a href="#echo-cmd">
                        echo_cmd                      </a>
                    </li>
                                                                              <li class='heading level-2'>
                      <a href="#Commands">
                        Commands                      </a>
                    </li>
                                                                              <li class='heading level-3'>
                      <a href="#commands">
                        commands                      </a>
                    </li>
                                                                              <li class='heading level-3'>
                      <a href="#isolate">
                        isolate                      </a>
                    </li>
                                                                              <li class='heading level-3'>
                      <a href="#in-directory">
                        in_directory                      </a>
                    </li>
                                                                              <li class='heading level-2'>
                      <a href="#Settings-helpers">
                        Settings helpers                      </a>
                    </li>
                                                                              <li class='heading level-3'>
                      <a href="#set">
                        set                      </a>
                    </li>
                                                                              <li class='heading level-3'>
                      <a href="#set-default">
                        set_default                      </a>
                    </li>
                                                                              <li class='heading level-3'>
                      <a href="#settings">
                        settings                      </a>
                    </li>
                                                                              <li class='heading level-3'>
                      <a href="#method-missing">
                        method_missing                      </a>
                    </li>
                                                                              <li class='heading level-2'>
                      <a href="#Command-line-mode-helpers">
                        Command line mode helpers                      </a>
                    </li>
                                                                              <li class='heading level-3'>
                      <a href="#verbose-mode">
                        verbose_mode?                      </a>
                    </li>
                                                                              <li class='heading level-3'>
                      <a href="#simulate-mode">
                        simulate_mode?                      </a>
                    </li>
                                                                              <li class='heading level-2'>
                      <a href="#Internal-helpers">
                        Internal helpers                      </a>
                    </li>
                                                                              <li class='heading level-3'>
                      <a href="#indent">
                        indent                      </a>
                    </li>
                                                                              <li class='heading level-3'>
                      <a href="#unindent">
                        unindent                      </a>
                    </li>
                                                                              <li class='heading level-3'>
                      <a href="#reindent">
                        reindent                      </a>
                    </li>
                                  </ul>
                          </li>
          </ul>

          <ul class='reference'>

            <!-- The reference page -->
                          <li class='page has-children level-0'>
                                  <span class='a'>Helpers</span>
                              </li>
            
            <!-- Subpages of the ref -->
                                                                                                                      
                <li class='page  level-1'>

                                                        <a href='../../lib/mina/deploy_helpers.html' class=''>Deploy helpers</a>
                  
                                                    </li>
                                                                                              
                <li class='page  level-1'>

                                                        <a href='../../lib/mina/exec_helpers.html' class=''>Exec helpers</a>
                  
                                                    </li>
                                                                                              
                <li class='page  level-1'>

                                                        <a href='../../lib/mina/helpers.html' class='active'>Default helpers</a>
                  
                                                    </li>
                                                                                              
                <li class='page  level-1'>

                                                        <a href='../../lib/mina/output_helpers.html' class=''>Output helpers</a>
                  
                                                    </li>
                                                                                              
                <li class='page  level-1'>

                                                        <a href='../../lib/mina/ssh_helpers.html' class=''>SSH helpers</a>
                  
                                                    </li>
                          
          </ul>
              </div>

      <div class='list files hidden'>
        
        <ul>
                  <li class='level-1'>
                                                    <a href='../../HISTORY.html#f' class='item file '>
                <i></i>
                HISTORY.md              </a>
                      </li>
                                    <li class='level-1'>
                                                    <a href='../../index.html#f' class='item file '>
                <i></i>
                index.md              </a>
                      </li>
                                    <li class='level-1'>
                                                    <button class='item folder expanded'>
                <i></i>
                lib              </button>
              <ul class=''>
                          <li class='level-2'>
                                                    <button class='item folder expanded'>
                <i></i>
                mina              </button>
              <ul class=''>
                          <li class='level-3'>
                                                    <a href='../../lib/mina/bundler.html#f' class='item file '>
                <i></i>
                bundler.rb              </a>
                      </li>
                                                    <li class='level-3'>
                                                    <a href='../../lib/mina/default.html#f' class='item file '>
                <i></i>
                default.rb              </a>
                      </li>
                                                    <li class='level-3'>
                                                    <a href='../../lib/mina/deploy.html#f' class='item file '>
                <i></i>
                deploy.rb              </a>
                      </li>
                                                    <li class='level-3'>
                                                    <a href='../../lib/mina/deploy_helpers.html#f' class='item file '>
                <i></i>
                deploy_helpers.rb              </a>
                      </li>
                                                    <li class='level-3'>
                                                    <a href='../../lib/mina/exec_helpers.html#f' class='item file '>
                <i></i>
                exec_helpers.rb              </a>
                      </li>
                                                    <li class='level-3'>
                                                    <a href='../../lib/mina/git.html#f' class='item file '>
                <i></i>
                git.rb              </a>
                      </li>
                                                    <li class='level-3'>
                                                    <a href='../../lib/mina/helpers.html#f' class='item file active'>
                <i></i>
                helpers.rb              </a>
                      </li>
                                                    <li class='level-3'>
                                                    <a href='../../lib/mina/output_helpers.html#f' class='item file '>
                <i></i>
                output_helpers.rb              </a>
                      </li>
                                                    <li class='level-3'>
                                                    <a href='../../lib/mina/rails.html#f' class='item file '>
                <i></i>
                rails.rb              </a>
                      </li>
                                                    <li class='level-3'>
                                                    <a href='../../lib/mina/rake.html#f' class='item file '>
                <i></i>
                rake.rb              </a>
                      </li>
                                                    <li class='level-3'>
                                                    <a href='../../lib/mina/rbenv.html#f' class='item file '>
                <i></i>
                rbenv.rb              </a>
                      </li>
                                                    <li class='level-3'>
                                                    <a href='../../lib/mina/rvm.html#f' class='item file '>
                <i></i>
                rvm.rb              </a>
                      </li>
                                                    <li class='level-3'>
                                                    <a href='../../lib/mina/settings.html#f' class='item file '>
                <i></i>
                settings.rb              </a>
                      </li>
                                                    <li class='level-3'>
                                                    <a href='../../lib/mina/ssh_helpers.html#f' class='item file '>
                <i></i>
                ssh_helpers.rb              </a>
                      </li>
                                                    <li class='level-3'>
                                                    <a href='../../lib/mina/tools.html#f' class='item file '>
                <i></i>
                tools.rb              </a>
                      </li>
                                                    <li class='level-3'>
                                                    <a href='../../lib/mina/version.html#f' class='item file '>
                <i></i>
                version.rb              </a>
                      </li>
                                                    <li class='level-3'>
                                                    <a href='../../lib/mina/whenever.html#f' class='item file '>
                <i></i>
                whenever.rb              </a>
                      </li>
                                                        </ul>
            </li>
                      </li>
                                                    <li class='level-2'>
                                                    <a href='../../lib/mina.html#f' class='item file '>
                <i></i>
                mina.rb              </a>
                      </li>
                                                        </ul>
            </li>
                      </li>
                                    <li class='level-1'>
                                                    <button class='item folder '>
                <i></i>
                manual              </button>
              <ul class='hidden'>
                          <li class='level-2'>
                                                    <a href='../../manual/modules.html#f' class='item file '>
                <i></i>
                modules.md              </a>
                      </li>
                                                        </ul>
            </li>
                      </li>
                                  </ul>

      </div>
    </div>

  </div>

  <script src='../../script.js'></script>
</body>
</html>
