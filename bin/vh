#!/usr/bin/env ruby
$:.unshift File.expand_path('../../lib', __FILE__)

require 'van_helsing'

file = lambda { |path| path if File.exists?(path) }

require 'rake'

Rake.application.instance_eval do
  standard_exception_handling do
    # Initialize Rake and make it think it's Van Helsing.
    init 'vh'
    @rakefiles = ['Vhfile', 'config/deploy.rb']

    # Load the Van Helsing Rake DSL.
    require 'van_helsing/rake'

    # Load the DSL that's relevant to deployment if you have a deploy.rb file.
    if have_rakefile
      require 'van_helsing/deploy'
      load_rakefile
    end

    # Run.
    top_level
  end
end

vh_cleanup! if Rake.application.top_level_tasks.any?
