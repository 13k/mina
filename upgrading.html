<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
  <head>
    <title>Upgrading notes</title>
    <meta charset='UTF-8' />
    <meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible' />
    <meta content='width=device-width, initial-scale=1.0' name='viewport' />
    <link href="stylesheets/site.css?1344377459" media="screen" rel="stylesheet" type="text/css" />
    <script src='http://cdnjs.cloudflare.com/ajax/libs/prettify/188.0.0/prettify.js'></script>
    <script src='http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.3.3/underscore-min.js'></script>
    <script src='https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js'></script>
    <script src="javascripts/site.js?1344377459" type="text/javascript"></script>
    <script>var _gaq = _gaq || [];_gaq.push(['_setAccount', "UA-32476157-1"]);_gaq.push(['_trackPageview']);(function() {var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);})();</script>
  </head>
  <body>
    <div id='top'>
      <a id="logo" href="./">Mina</a>
    </div>
    <div id='area'>
      <div id='content'>
        <section id='search'>
          <input placeholder='Search...' type='text' />
          <ul class='results'></ul>
        </section>
        <div class='c'>
          <a class='github' href='https://github.com/nadarei/mina'>
            <img alt='Fork me on GitHub' src='https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png' />
          </a>
          <div id='crumbs'>
            <a href="./">Mina</a>
            <strong>Upgrading notes</strong>
          </div>
          <hgroup>
            <h1>Upgrading notes</h1>
          </hgroup>
          <div class='content'>
            <h2 id='upgrading_to_v020'>Upgrading to v0.2.0</h2>

<p>Note: these are upgrade notes to the <em>unreleased</em> v0.2.0 version due to be released soon.</p>

<p>Mina v0.2.0 is backwards-compatible, except for the deprecated <code>:revision</code> setting (which wasn&#8217;t widely used anyway). However, Mina 0.2.0 adds new features and conveniences that may make it easier to implement tasks you&#8217;re already doing.</p>

<h3 id='new_default_script'>New default script</h3>

<p>The new default deploy script generated by <code>mina init</code> has been improved to add more helpful comments to get you started. While not really necessary, try doing <code>mina init</code> <em>in an empty directory</em> to see the new default script.</p>

<pre><code># In an empty directory:
$ mina init
$ cat config/deploy.rb</code></pre>

<h3 id='rvm_support'>RVM support</h3>

<p>The previous recommendation was to make your <code>~/.bashrc</code> load RVM. This was a little problematic: in Ubuntu systems, RVM wasn&#8217;t always loaded because <code>.bashrc</code> wasn&#8217;t loaded entirely in interactive shells. Also, some people prefer to load RVM in <code>~/.bash_profile</code>.</p>

<p>To use RVM on Mina 0.2, make a task called <code>:environment</code> and from there, invoke <code>rvm:use[RUBY_VERSION@GEMSET]</code> like so:</p>

<pre><code># config/deploy.rb
require &#39;mina/rvm&#39;

task :enviroment do
  invoke :&#39;rvm:use[ruby-1.9.2@default]&#39;
end

task :deploy =&gt; :environment do
  ...
  # continue as usual
  ...
end</code></pre>

<p>You do not need to create an <code>.rvmrc</code> file, although it is supported. In fact, as <code>.rvmrc</code> files are usually environment-specific, this practice is discouraged.</p>

<p>A sample configuration can be seen by creating a new project using <code>mina init</code> (see <a href='#new_default_script'>&#8220;New default script&#8221;</a> section above).</p>

<h3 id='rbenv_support'>rbenv support</h3>

<p>Mina v0.2 also features rbenv support. Like in RVM, older solutions of loading rbenv in <code>~/.bashrc</code> will continue to work, however you&#8217;re recommended to use the new <code>rbenv:load</code> task.</p>

<pre><code># config/deploy.rb
require &#39;mina/rbenv&#39;

task :enviroment do
  invoke :&#39;rbenv:load&#39;
end

task :deploy =&gt; :environment do
  ...
  # continue as usual
  ...
end</code></pre>

<p>Be sure to commit your <code>.rbenv-version</code> file in your project repository.</p>

<h3 id='git_removed_the_revision_setting'>Git: removed the :revision setting</h3>

<p>The <code>:revision</code> setting has been removed in Mina v0.2.0. This used to allow you to deploy any given Git branch, tag, or commit.</p>

<p>It has now been superceded by the <code>:commit</code> and <code>:branch</code> settings. To deploy a branch, set the <code>:branch</code> setting:</p>

<pre><code>set :branch, &#39;master&#39;</code></pre>

<p>And to deploy a given commit, set the <code>:commit</code> setting:</p>

<pre><code>set :commit, &#39;2f19299a&#39;</code></pre>

<p>The reason for this change is that Git deploys are now optimized to be much faster when branches are specified.</p>

<h3 id='git_the_default_branch_is_now_master'>Git: the default branch is now &#8216;master&#8217;</h3>

<p>In Mina v0.1.x, the default deploy behavior is to deploy whatever the current commit is in your Git working repository.</p>

<p>In 0.2.0, the default is now the <code>master</code> branch. To change this, change the <code>:branch</code> setting:</p>

<pre><code>set :branch, &#39;deploy&#39;</code></pre>

<h3 id='the_deploylink_shared_paths_task'>The &#8216;deploy:link_shared_paths&#8217; task</h3>

<p>The <code>deploy:link_shared_paths</code> task has been existing since Mina v0.1.x, but was not documented.</p>

<p>To make certain directories/files shared between different releases, first specify them in the <code>:shared_paths</code> setting:</p>

<pre><code>set :shared_paths, [&#39;log&#39;, &#39;config/database.yml&#39;]</code></pre>

<p>And link them in your deploy script by invoking <code>deploy:link_shared_paths</code>:</p>

<pre><code>task :deploy =&gt; :environment do
  deploy do
    invoke :&#39;git:clone&#39;
    invoke :&#39;deploy:link_shared_paths&#39;
    ...
    ...
  end
end</code></pre>

<h3 id='new_environment_task_convention'>New &#8216;:environment&#8217; task convention</h3>

<p>Mina introduces a new recommended convention of defining an <code>:environment</code> task to do initializations used for every command.</p>

<p>It is often used to load RVM or rbenv so that it will be available in <code>mina
deploy</code>, <code>mina rake[db:migrate]</code>, and other similar tasks.</p>

<p>Define the task in your deploy script like so:</p>

<pre><code>task :environment do
  invoke :&#39;rbenv:load&#39;
end</code></pre>

<p>Then make the deploy task <em>depend</em> on it:</p>

<pre><code>task :deploy =&gt; :environment do
  ...
end</code></pre>

<p>This instructs Rake (or rather, Mina) to load the <code>:environment</code> task before deploying.</p>

<p>This is entirely optional, but highly recommended.</p>
            <section class='footer'>
              <div class='left'>
                <strong>
                  <a href="./">Mina
                  </a>
                  <span class='arrow'>&rsaquo;</span>
                  Upgrading notes
                </strong>
              </div>
            </section>
          </div>
        </div>
        <nav id='nav'>
          <div class='logo'>
            <a href="./"><img width="150" src="images/logo.png?1344377458" /></a>
          </div>
          <nav class='parents'>
            <ul>
              <li>
                <a class="more" href="./">Mina</a>
              </li>
            </ul>
          </nav>
          <nav>
            <h4>Getting started</h4>
            <ul>
              <li>
                <a class="" href="setting_up_a_project.html">Setting up a project</a>
              </li>
              <li>
                <a class="" href="about_deploy_rb.html">About deploy.rb</a>
              </li>
              <li>
                <a class="" href="command_queue.html">Command queue</a>
              </li>
              <li>
                <a class="" href="subtasks.html">Subtasks</a>
              </li>
              <li>
                <a class="" href="directory_structure.html">Directory structure</a>
              </li>
              <li>
                <a class="" href="deploying.html">Deploying</a>
              </li>
            </ul>
          </nav>
          <nav>
            <h4>Misc</h4>
            <ul>
              <li>
                <a class="active" href="upgrading.html">Upgrading notes</a>
              </li>
            </ul>
          </nav>
          <nav>
            <h4>API</h4>
            <ul>
              <li>
                <a class="" href="command_line_options.html">Command line options</a>
              </li>
              <li>
                <a class="more" href="settings/">Settings</a>
              </li>
              <li>
                <a class="more" href="tasks/">Tasks</a>
              </li>
              <li>
                <a class="more" href="helpers/">Helpers</a>
              </li>
            </ul>
          </nav>
        </nav>
      </div>
    </div>
  </body>
</html>
